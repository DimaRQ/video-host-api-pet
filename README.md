# Video Host API - пет проект

Простой бекенд видео-хостинга, полностью асинхронный, позволяет загружать, смотреть и удалять .mp4 видео. Для хранения видео используется S3 хранилище.

> Репозиторий не является релиз версией, в нем многое упрощено


## Демо
После запуска проекта swagger доступен по ссылкам [/docs](http://localhost:8000/docs) и [/redoc](http://localhost:8000/redoc)


## Возможности
| Функция                             | Описание                                                                   |
|-------------------------------------|----------------------------------------------------------------------------|
| POST /video/upload - Загрузка видео | MIME-валидация, проверка размера                                           |
| Фоновая обработка                   | Создается очередь Kafka, бекгроунд функция обрабатывает сообщения в фоне   |
| JWT                                 | /auth/register /auth/login, хеши bcrypt                                    |
| Rate‑limit и блокировка IP          | Redis, настройка в .env                                                    |
| Тесты на PyTest                     | Тестирование функций secure и API                                          |
--------------------------------------------------------------------------------------------------------------------


## Технологии
| Название         | Зачем                      |
|------------------|----------------------------|
| FastAPI, Uvicorn | Асинхронный API            |
| SQLAlchemy       | ORM для PostreSQL          |
| Alembic          | Миграция БД                |
| Kafka            | Очередь для загрузки видео |
| Redis            | RateLimit                  |
| Aioboto3         | Работа с S3                |
| Passlib, PyJWT   | Пароли и токены            |
| HTTPX, pytest    | Автотесты                  |


## Структура проекта
```bazaar
|
|-src/
|   |-auth/          # Регистрация, авторизация
|   |-video/         # Загрузка видео
|   |-background/    # Консьюмер кафки и загрузка в S3
|   |-kafka/         # Врапперы продюсера и консьюмера
|   |-s3/            # Генератор сессии S3
|   |-db/            # Сессия SQLAlchemy
|   |utils/          # Конфиг, логгер, MIME-type
|-templates/         # player.html
|-tests/
|-requirements.txt   # Зависимости проекта
|-main.py
```


## Быстрый старт
```bash
# Клонирование проекта
git clone https://github.com/DimaRQ/video-host-api-pet.git
cd video-host-api-pet

# Настраиваем .env
mv .env-example .env
nano .env

# Запуск докера
docker compose up --build
```


## Краткая документация по API
| Метод   | Путь               | Описание                                                                 |
|---------|--------------------|--------------------------------------------------------------------------|
| POST    | /auth/register     | Регистрация пользователя                                                 |
| POST    | /auth/login        | Получить Bearer токена                                                   |
| POST    | /video/upload      | Отправка видео в очередь на загрузку                                     |
| GET     | /video/{id}/status | Получить статус видео, находится ли оно все еще в очереди или обработано |
| GET     | /video/{id}/player | HTML плеер для просмотра видео                                           |
| DELETE  | /video/{id}        | Удалить видео из БД и S3                                                 |


## Тестирование 
pytest -q


## TODO
- [X] CI/CD
- [X] Docker